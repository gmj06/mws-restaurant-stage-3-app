let restaurant;
var map;
/**
 * Lazy Loading Images by setting src attribute only after page load and removing data-src attribute 
 */
// window.addEventListener('DOMContentLoaded', (event) => {
//   console.log("eventlistener...load");
//   let img = document.querySelector('img.restaurant-img[data-src]');
//   img.setAttribute('src', img.getAttribute('data-src'));
//   img.onload = function () {
//     img.removeAttribute('data-src');
//   };
// });

/**
 * Initialize Google map, called from HTML.
 */

window.initMap = () => {
  fetchRestaurantFromURL((error, restaurant) => {
    if (error) {
      // Got an error!
      console.error(error);
    } else {
      self.map = new google.maps.Map(document.getElementById('map'), {
        zoom: 16,
        center: restaurant.latlng,
        scrollwheel: false
      });
      fillBreadcrumb();
      DBHelper.mapMarkerForRestaurant(self.restaurant, self.map);
    }
  });
};
/**
 * Get current restaurant from page URL.
 */


fetchRestaurantFromURL = callback => {
  if (self.restaurant) {
    // restaurant already fetched!
    callback(null, self.restaurant);
    return;
  }

  const id = getParameterByName('id');

  if (!id) {
    // no id found in URL
    error = 'No restaurant id in URL';
    callback(error, null);
  } else {
    DBHelper.fetchRestaurantById(id, (error, restaurant) => {
      self.restaurant = restaurant;

      if (!restaurant) {
        console.error(error);
        return;
      }

      fillRestaurantHTML();
      callback(null, restaurant);
    });
  }
};
/**
 * Create restaurant HTML and add it to the webpage
 */


fillRestaurantHTML = (restaurant = self.restaurant) => {
  const name = document.getElementById('restaurant-name');
  name.innerHTML = restaurant.name;
  const address = document.getElementById('restaurant-address');
  address.innerHTML = restaurant.address;
  const image = document.getElementById('restaurant-img');
  image.className = 'restaurant-img';
  const imageurl = DBHelper.imageUrlForRestaurant(restaurant, "banners");
  const imgparts = imageurl.split(".");
  const imgurl1x = imgparts[0] + "-500w_1x." + imgparts[1];
  const imgurl2x = imgparts[0] + "-800w_2x." + imgparts[1];
  image.src = imgurl1x;
  image.srcset = `${imgurl1x} 500w, ${imgurl2x} 800w`;
  image.alt = restaurant.name + " banner image"; //image.setAttribute('data-src', imgurl1x);

  const cuisine = document.getElementById('restaurant-cuisine');
  cuisine.innerHTML = restaurant.cuisine_type; // fill operating hours

  if (restaurant.operating_hours) {
    fillRestaurantHoursHTML();
  } // fill reviews
  //fillReviewsHTML();


  DBHelper.fetchReviewsByRestaurantId(restaurant.id, fillReviewsHTML);
};
/**
 * Create restaurant operating hours HTML table and add it to the webpage.
 */


fillRestaurantHoursHTML = (operatingHours = self.restaurant.operating_hours) => {
  const title = document.createElement('h3');
  title.innerHTML = 'Hours of Operation';
  const hours = document.getElementById('restaurant-hours');
  hours.insertBefore(title, hours.childNodes[0]);

  for (let key in operatingHours) {
    const row = document.createElement('tr');
    const day = document.createElement('td');
    day.innerHTML = key.trim();
    row.appendChild(day);
    const time = document.createElement('td');
    time.innerHTML = operatingHours[key].trim();
    row.appendChild(time);
    hours.appendChild(row);
  }
};
/**
 * Create all reviews HTML and add them to the webpage.
 */
// fillReviewsHTML = (error, reviews = self.restaurant.reviews) => {


fillReviewsHTML = (error, reviews) => {
  self.restaurant.reviews = reviews;

  if (error) {
    console.log("fillReviewsHTML...", error);
  }

  const container = document.getElementById('reviews-container');
  const reviewsHeading = document.createElement('div');
  reviewsHeading.setAttribute('id', 'reviews-container-heading');
  container.appendChild(reviewsHeading);
  const title = document.createElement('h2');
  title.innerHTML = 'Reviews';
  reviewsHeading.appendChild(title);
  const btnAddAReview = document.createElement('button');
  btnAddAReview.innerHTML = "Add a Review";
  btnAddAReview.setAttribute('id', 'add-review-btn');

  btnAddAReview.onclick = () => {
    newReviewformReset();
    const newReviewForm = document.getElementById('add-review-container');

    if (btnAddAReview.innerHTML == 'Add a Review') {
      newReviewForm.style.display = 'block';
      btnAddAReview.innerHTML = "Hide Add Review";
      reviewsHeading.appendChild(newReviewForm);
    } else {
      btnAddAReview.innerHTML = "Add a Review";
      newReviewForm.style.display = 'none';
    }
  };

  reviewsHeading.appendChild(btnAddAReview);

  if (!reviews) {
    const noReviews = document.createElement('p');
    noReviews.innerHTML = 'No reviews yet!';
    container.appendChild(noReviews);
    return;
  }

  const ul = document.getElementById('reviews-list');
  reviews.forEach(review => {
    ul.appendChild(createReviewHTML(review));
  });
  container.appendChild(ul);
};
/**
 * Create review HTML and add it to the webpage.
 */


createReviewHTML = review => {
  const li = document.createElement('li');

  if (!window.navigator.onLine) {
    const offlineLabel = document.createElement('p');
    offlineLabel.innerHTML = "Offline Mode";
    offlineLabel.classList.add('offline-mode-label');
    li.classList.add('review-offline-mode');
    li.appendChild(offlineLabel);
  }

  const name = document.createElement('p');
  name.innerHTML = review.name;
  li.appendChild(name);
  const date = document.createElement('p');
  let timestamp = new Date(review.createdAt);
  let options = {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  };
  date.innerHTML = timestamp.toLocaleDateString("en-US", options);
  li.appendChild(date);
  const rating = document.createElement('p');
  rating.innerHTML = `Rating: ${review.rating}`;
  li.appendChild(rating);
  const comments = document.createElement('p');
  comments.innerHTML = review.comments;
  li.appendChild(comments);
  return li;
};
/**
 * Add restaurant name to the breadcrumb navigation menu
 */


fillBreadcrumb = (restaurant = self.restaurant) => {
  const breadcrumb = document.getElementById('breadcrumb');
  const li = document.createElement('li');
  li.innerHTML = restaurant.name;
  breadcrumb.appendChild(li);
};
/**
 * Get a parameter by name from page URL.
 */


getParameterByName = (name, url) => {
  if (!url) url = window.location.href;
  name = name.replace(/[\[\]]/g, '\\$&');
  const regex = new RegExp(`[?&]${name}(=([^&#]*)|&|#|$)`),
        results = regex.exec(url);
  if (!results) return null;
  if (!results[2]) return '';
  return decodeURIComponent(results[2].replace(/\+/g, ' '));
};

clearErrorMessage = (event, id) => {
  if (event.keyCode === 13) {
    event.preventDefault();
  }

  document.getElementById(`${id}-error`).innerHTML = "";
};

newReviewformReset = () => {
  document.getElementById('new-review-form').reset();
  document.getElementById("reviewer-name-error").innerHTML = "";
  document.getElementById("reviewer-comments-error").innerHTML = "";
};

addReviewHTMLToDOM = reviewObj => {
  const ul = document.getElementById('reviews-list');
  ul.insertBefore(createReviewHTML(reviewObj), ul.childNodes[0]);
};

addNewReview = event => {
  //event.preventDefault();
  const reviewAuthor = document.getElementById("reviewer-name").value; //const reviewerRatingSelect = document.getElementById("reviewer-rating-select");
  //const reviewerRating = reviewerRatingSelect.options[reviewerRatingSelect.selectedIndex].value;

  const reviewerRating = document.querySelector("#reviewer-rating-select option:checked").value;
  const reviewerComments = document.getElementById("reviewer-comments").value;
  document.getElementById("reviewer-name-error").innerHTML = "";
  document.getElementById("reviewer-comments-error").innerHTML = "";

  if (reviewAuthor == "") {
    document.getElementById("reviewer-name-error").innerHTML = "Please enter your name";
    return false;
  }

  if (reviewerComments == "") {
    document.getElementById("reviewer-comments-error").innerHTML = "Please enter your comments";
    return false;
  }

  document.getElementById("add-review-submit").disabled = true;
  console.log(self.restaurant.id, reviewAuthor, reviewerRating, reviewerComments);
  const reviewObj = {
    "restaurant_id": parseInt(self.restaurant.id),
    "name": reviewAuthor,
    "rating": parseInt(reviewerRating),
    "comments": reviewerComments
  };
  const IDBobj = {
    "restaurant_id": parseInt(self.restaurant.id),
    "name": reviewAuthor,
    "rating": parseInt(reviewerRating),
    "comments": reviewerComments,
    "createdAt": new Date() // console.log('robj..', robj);

  };
  DBHelper.addNewReview(self.restaurant.id, reviewObj, (error, review) => {
    if (error) {
      console.log("Unable to add new review to server", error);
    }

    document.getElementById("add-review-submit").disabled = false;
  }); //DBHelper.addNewReview(self.restaurant.id, reviewObj);

  addReviewHTMLToDOM(IDBobj);
  newReviewformReset();
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwibWFwIiwid2luZG93IiwiaW5pdE1hcCIsImZldGNoUmVzdGF1cmFudEZyb21VUkwiLCJlcnJvciIsImNvbnNvbGUiLCJzZWxmIiwiZ29vZ2xlIiwibWFwcyIsIk1hcCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJ6b29tIiwiY2VudGVyIiwibGF0bG5nIiwic2Nyb2xsd2hlZWwiLCJmaWxsQnJlYWRjcnVtYiIsIkRCSGVscGVyIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsImNhbGxiYWNrIiwiaWQiLCJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJmZXRjaFJlc3RhdXJhbnRCeUlkIiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwibmFtZSIsImlubmVySFRNTCIsImFkZHJlc3MiLCJpbWFnZSIsImNsYXNzTmFtZSIsImltYWdldXJsIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwiaW1ncGFydHMiLCJzcGxpdCIsImltZ3VybDF4IiwiaW1ndXJsMngiLCJzcmMiLCJzcmNzZXQiLCJhbHQiLCJjdWlzaW5lIiwiY3Vpc2luZV90eXBlIiwib3BlcmF0aW5nX2hvdXJzIiwiZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwiLCJmZXRjaFJldmlld3NCeVJlc3RhdXJhbnRJZCIsImZpbGxSZXZpZXdzSFRNTCIsIm9wZXJhdGluZ0hvdXJzIiwidGl0bGUiLCJjcmVhdGVFbGVtZW50IiwiaG91cnMiLCJpbnNlcnRCZWZvcmUiLCJjaGlsZE5vZGVzIiwia2V5Iiwicm93IiwiZGF5IiwidHJpbSIsImFwcGVuZENoaWxkIiwidGltZSIsInJldmlld3MiLCJsb2ciLCJjb250YWluZXIiLCJyZXZpZXdzSGVhZGluZyIsInNldEF0dHJpYnV0ZSIsImJ0bkFkZEFSZXZpZXciLCJvbmNsaWNrIiwibmV3UmV2aWV3Zm9ybVJlc2V0IiwibmV3UmV2aWV3Rm9ybSIsInN0eWxlIiwiZGlzcGxheSIsIm5vUmV2aWV3cyIsInVsIiwiZm9yRWFjaCIsInJldmlldyIsImNyZWF0ZVJldmlld0hUTUwiLCJsaSIsIm5hdmlnYXRvciIsIm9uTGluZSIsIm9mZmxpbmVMYWJlbCIsImNsYXNzTGlzdCIsImFkZCIsImRhdGUiLCJ0aW1lc3RhbXAiLCJEYXRlIiwiY3JlYXRlZEF0Iiwib3B0aW9ucyIsIndlZWtkYXkiLCJ5ZWFyIiwibW9udGgiLCJ0b0xvY2FsZURhdGVTdHJpbmciLCJyYXRpbmciLCJjb21tZW50cyIsImJyZWFkY3J1bWIiLCJ1cmwiLCJsb2NhdGlvbiIsImhyZWYiLCJyZXBsYWNlIiwicmVnZXgiLCJSZWdFeHAiLCJyZXN1bHRzIiwiZXhlYyIsImRlY29kZVVSSUNvbXBvbmVudCIsImNsZWFyRXJyb3JNZXNzYWdlIiwiZXZlbnQiLCJrZXlDb2RlIiwicHJldmVudERlZmF1bHQiLCJyZXNldCIsImFkZFJldmlld0hUTUxUb0RPTSIsInJldmlld09iaiIsImFkZE5ld1JldmlldyIsInJldmlld0F1dGhvciIsInZhbHVlIiwicmV2aWV3ZXJSYXRpbmciLCJxdWVyeVNlbGVjdG9yIiwicmV2aWV3ZXJDb21tZW50cyIsImRpc2FibGVkIiwicGFyc2VJbnQiLCJJREJvYmoiXSwibWFwcGluZ3MiOiJBQUFBLElBQUlBLFVBQUo7QUFDQSxJQUFJQyxHQUFKO0FBRUE7OztBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBS0E7Ozs7QUFHQUMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCLE1BQU07QUFDckJDLEVBQUFBLHNCQUFzQixDQUFDLENBQUNDLEtBQUQsRUFBUUwsVUFBUixLQUF1QjtBQUM1QyxRQUFJSyxLQUFKLEVBQVc7QUFBRTtBQUNYQyxNQUFBQSxPQUFPLENBQUNELEtBQVIsQ0FBY0EsS0FBZDtBQUNELEtBRkQsTUFFTztBQUNMRSxNQUFBQSxJQUFJLENBQUNOLEdBQUwsR0FBVyxJQUFJTyxNQUFNLENBQUNDLElBQVAsQ0FBWUMsR0FBaEIsQ0FBb0JDLFFBQVEsQ0FBQ0MsY0FBVCxDQUF3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QUFPQSxRQUFNRyxNQUFNLEdBQUc7QUFDYixxQkFBaUJELFFBQVEsQ0FBQzNHLElBQUksQ0FBQ1AsVUFBTCxDQUFnQnFCLEVBQWpCLENBRFo7QUFFYixZQUFRdUYsWUFGSztBQUdiLGNBQVVNLFFBQVEsQ0FBQ0osY0FBRCxDQUhMO0FBSWIsZ0JBQVlFLGdCQUpDO0FBS2IsaUJBQWEsSUFBSS9CLElBQUosRUFMQSxDQVFmOztBQVJlLEdBQWY7QUFTQS9ELEVBQUFBLFFBQVEsQ0FBQ3lGLFlBQVQsQ0FBc0JwRyxJQUFJLENBQUNQLFVBQUwsQ0FBZ0JxQixFQUF0QyxFQUEwQ3FGLFNBQTFDLEVBQXFELENBQUNyRyxLQUFELEVBQVFrRSxNQUFSLEtBQW1CO0FBQ3RFLFFBQUlsRSxLQUFKLEVBQVc7QUFDVEMsTUFBQUEsT0FBTyxDQUFDb0QsR0FBUixDQUFZLG9DQUFaLEVBQWtEckQsS0FBbEQ7QUFDRDs7QUFDRE0sSUFBQUEsUUFBUSxDQUFDQyxjQUFULENBQXdCLG1CQUF4QixFQUE2Q3FHLFFBQTdDLEdBQXdELEtBQXhEO0FBQ0QsR0FMRCxFQXRDd0IsQ0E0Q3hCOztBQUNBUixFQUFBQSxrQkFBa0IsQ0FBQ1UsTUFBRCxDQUFsQjtBQUNBbkQsRUFBQUEsa0JBQWtCO0FBRW5CLENBaEREIiwic291cmNlc0NvbnRlbnQiOlsibGV0IHJlc3RhdXJhbnQ7XG52YXIgbWFwO1xuXG4vKipcbiAqIExhenkgTG9hZGluZyBJbWFnZXMgYnkgc2V0dGluZyBzcmMgYXR0cmlidXRlIG9ubHkgYWZ0ZXIgcGFnZSBsb2FkIGFuZCByZW1vdmluZyBkYXRhLXNyYyBhdHRyaWJ1dGUgXG4gKi9cbi8vIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKGV2ZW50KSA9PiB7XG4vLyAgIGNvbnNvbGUubG9nKFwiZXZlbnRsaXN0ZW5lci4uLmxvYWRcIik7XG4vLyAgIGxldCBpbWcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbWcucmVzdGF1cmFudC1pbWdbZGF0YS1zcmNdJyk7XG5cbi8vICAgaW1nLnNldEF0dHJpYnV0ZSgnc3JjJywgaW1nLmdldEF0dHJpYnV0ZSgnZGF0YS1zcmMnKSk7XG4vLyAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4vLyAgICAgaW1nLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1zcmMnKTtcbi8vICAgfTtcbi8vIH0pO1xuIFxuXG5cblxuLyoqXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXG4gKi9cbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xuICBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuICAgICAgICB6b29tOiAxNixcbiAgICAgICAgY2VudGVyOiByZXN0YXVyYW50LmxhdGxuZyxcbiAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXG4gICAgICB9KTtcbiAgICAgIGZpbGxCcmVhZGNydW1iKCk7XG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5tYXApO1xuICAgIH1cbiAgfSk7XG59XG5cbi8qKlxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxuICovXG5mZXRjaFJlc3RhdXJhbnRGcm9tVVJMID0gKGNhbGxiYWNrKSA9PiB7XG4gIGlmIChzZWxmLnJlc3RhdXJhbnQpIHsgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXG4gICAgY2FsbGJhY2sobnVsbCwgc2VsZi5yZXN0YXVyYW50KVxuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcbiAgaWYgKCFpZCkgeyAvLyBubyBpZCBmb3VuZCBpbiBVUkxcbiAgICBlcnJvciA9ICdObyByZXN0YXVyYW50IGlkIGluIFVSTCdcbiAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gIH0gZWxzZSB7XG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XG4gICAgICBzZWxmLnJlc3RhdXJhbnQgPSByZXN0YXVyYW50O1xuICAgICAgaWYgKCFyZXN0YXVyYW50KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBmaWxsUmVzdGF1cmFudEhUTUwoKTtcbiAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpXG4gICAgfSk7XG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2VcbiAqL1xuZmlsbFJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LW5hbWUnKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG5cbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWFkZHJlc3MnKTtcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XG5cbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1pbWcnKTtcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJ1xuICBjb25zdCBpbWFnZXVybCA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBcImJhbm5lcnNcIik7XG4gIGNvbnN0IGltZ3BhcnRzID0gaW1hZ2V1cmwuc3BsaXQoXCIuXCIpO1xuICBjb25zdCBpbWd1cmwxeCA9IGltZ3BhcnRzWzBdICsgXCItNTAwd18xeC5cIiArIGltZ3BhcnRzWzFdO1xuICBjb25zdCBpbWd1cmwyeCA9IGltZ3BhcnRzWzBdICsgXCItODAwd18yeC5cIiArIGltZ3BhcnRzWzFdO1xuICBpbWFnZS5zcmMgPSBpbWd1cmwxeDtcbiAgaW1hZ2Uuc3Jjc2V0ID0gYCR7aW1ndXJsMXh9IDUwMHcsICR7aW1ndXJsMnh9IDgwMHdgO1xuICBpbWFnZS5hbHQgPSByZXN0YXVyYW50Lm5hbWUgKyBcIiBiYW5uZXIgaW1hZ2VcIjtcbiAgLy9pbWFnZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtc3JjJywgaW1ndXJsMXgpO1xuXG4gIGNvbnN0IGN1aXNpbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1jdWlzaW5lJyk7XG4gIGN1aXNpbmUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5jdWlzaW5lX3R5cGU7XG5cbiAgLy8gZmlsbCBvcGVyYXRpbmcgaG91cnNcbiAgaWYgKHJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSB7XG4gICAgZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwoKTtcbiAgfVxuICAvLyBmaWxsIHJldmlld3NcbiAgLy9maWxsUmV2aWV3c0hUTUwoKTtcbiAgREJIZWxwZXIuZmV0Y2hSZXZpZXdzQnlSZXN0YXVyYW50SWQocmVzdGF1cmFudC5pZCwgZmlsbFJldmlld3NIVE1MKTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBvcGVyYXRpbmcgaG91cnMgSFRNTCB0YWJsZSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5maWxsUmVzdGF1cmFudEhvdXJzSFRNTCA9IChvcGVyYXRpbmdIb3VycyA9IHNlbGYucmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpID0+IHtcbiAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMycpO1xuICB0aXRsZS5pbm5lckhUTUwgPSAnSG91cnMgb2YgT3BlcmF0aW9uJztcblxuICBjb25zdCBob3VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWhvdXJzJyk7XG4gIGhvdXJzLmluc2VydEJlZm9yZSh0aXRsZSwgaG91cnMuY2hpbGROb2Rlc1swXSk7XG4gIGZvciAobGV0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xuICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG5cbiAgICBjb25zdCBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIGRheS5pbm5lckhUTUwgPSBrZXkudHJpbSgpO1xuICAgIHJvdy5hcHBlbmRDaGlsZChkYXkpO1xuXG4gICAgY29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldLnRyaW0oKTtcbiAgICByb3cuYXBwZW5kQ2hpbGQodGltZSk7XG5cbiAgICBob3Vycy5hcHBlbmRDaGlsZChyb3cpO1xuICB9XG59XG5cbi8qKlxuICogQ3JlYXRlIGFsbCByZXZpZXdzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxuICovXG4vLyBmaWxsUmV2aWV3c0hUTUwgPSAoZXJyb3IsIHJldmlld3MgPSBzZWxmLnJlc3RhdXJhbnQucmV2aWV3cykgPT4ge1xuZmlsbFJldmlld3NIVE1MID0gKGVycm9yLCByZXZpZXdzKSA9PiB7XG4gIHNlbGYucmVzdGF1cmFudC5yZXZpZXdzID0gcmV2aWV3cztcblxuICBpZiAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmxvZyhcImZpbGxSZXZpZXdzSFRNTC4uLlwiLCBlcnJvcik7XG4gIH1cbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtY29udGFpbmVyJyk7XG4gIGNvbnN0IHJldmlld3NIZWFkaW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIHJldmlld3NIZWFkaW5nLnNldEF0dHJpYnV0ZSgnaWQnLCAncmV2aWV3cy1jb250YWluZXItaGVhZGluZycpO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQocmV2aWV3c0hlYWRpbmcpO1xuXG4gIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcbiAgdGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnO1xuICByZXZpZXdzSGVhZGluZy5hcHBlbmRDaGlsZCh0aXRsZSk7XG5cbiAgY29uc3QgYnRuQWRkQVJldmlldyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuICBidG5BZGRBUmV2aWV3LmlubmVySFRNTCA9IFwiQWRkIGEgUmV2aWV3XCI7XG4gIGJ0bkFkZEFSZXZpZXcuc2V0QXR0cmlidXRlKCdpZCcsICdhZGQtcmV2aWV3LWJ0bicpO1xuICBidG5BZGRBUmV2aWV3Lm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgbmV3UmV2aWV3Zm9ybVJlc2V0KCk7XG4gICAgY29uc3QgbmV3UmV2aWV3Rm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGQtcmV2aWV3LWNvbnRhaW5lcicpO1xuXG4gICAgaWYgKGJ0bkFkZEFSZXZpZXcuaW5uZXJIVE1MID09ICdBZGQgYSBSZXZpZXcnKSB7XG4gICAgICBuZXdSZXZpZXdGb3JtLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgYnRuQWRkQVJldmlldy5pbm5lckhUTUwgPSBcIkhpZGUgQWRkIFJldmlld1wiO1xuICAgICAgcmV2aWV3c0hlYWRpbmcuYXBwZW5kQ2hpbGQobmV3UmV2aWV3Rm9ybSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGJ0bkFkZEFSZXZpZXcuaW5uZXJIVE1MID0gXCJBZGQgYSBSZXZpZXdcIjtcbiAgICAgIG5ld1Jldmlld0Zvcm0uc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICB9XG4gIH1cbiAgcmV2aWV3c0hlYWRpbmcuYXBwZW5kQ2hpbGQoYnRuQWRkQVJldmlldyk7XG5cbiAgaWYgKCFyZXZpZXdzKSB7XG4gICAgY29uc3Qgbm9SZXZpZXdzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICAgIG5vUmV2aWV3cy5pbm5lckhUTUwgPSAnTm8gcmV2aWV3cyB5ZXQhJztcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQobm9SZXZpZXdzKTtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XG4gIHJldmlld3MuZm9yRWFjaChyZXZpZXcgPT4ge1xuICAgIHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XG4gIH0pO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodWwpO1xufVxuXG4vKipcbiAqIENyZWF0ZSByZXZpZXcgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5jcmVhdGVSZXZpZXdIVE1MID0gKHJldmlldykgPT4ge1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG5cbiAgaWYgKCF3aW5kb3cubmF2aWdhdG9yLm9uTGluZSkge1xuICAgIGNvbnN0IG9mZmxpbmVMYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBvZmZsaW5lTGFiZWwuaW5uZXJIVE1MID0gXCJPZmZsaW5lIE1vZGVcIjtcbiAgICBvZmZsaW5lTGFiZWwuY2xhc3NMaXN0LmFkZCgnb2ZmbGluZS1tb2RlLWxhYmVsJyk7XG4gICAgbGkuY2xhc3NMaXN0LmFkZCgncmV2aWV3LW9mZmxpbmUtbW9kZScpO1xuICAgIGxpLmFwcGVuZENoaWxkKG9mZmxpbmVMYWJlbCk7XG4gIH1cblxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xuICBsaS5hcHBlbmRDaGlsZChuYW1lKTtcblxuICBjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBsZXQgdGltZXN0YW1wID0gbmV3IERhdGUocmV2aWV3LmNyZWF0ZWRBdCk7XG4gIGxldCBvcHRpb25zID0geyB3ZWVrZGF5OiAnbG9uZycsIHllYXI6ICdudW1lcmljJywgbW9udGg6ICdsb25nJywgZGF5OiAnbnVtZXJpYycgfTtcblxuICBkYXRlLmlubmVySFRNTCA9IHRpbWVzdGFtcC50b0xvY2FsZURhdGVTdHJpbmcoXCJlbi1VU1wiLCBvcHRpb25zKTtcbiAgbGkuYXBwZW5kQ2hpbGQoZGF0ZSk7XG5cbiAgY29uc3QgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICByYXRpbmcuaW5uZXJIVE1MID0gYFJhdGluZzogJHtyZXZpZXcucmF0aW5nfWA7XG4gIGxpLmFwcGVuZENoaWxkKHJhdGluZyk7XG5cbiAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbW1lbnRzLmlubmVySFRNTCA9IHJldmlldy5jb21tZW50cztcbiAgbGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xuXG4gIHJldHVybiBsaTtcbn1cblxuLyoqXG4gKiBBZGQgcmVzdGF1cmFudCBuYW1lIHRvIHRoZSBicmVhZGNydW1iIG5hdmlnYXRpb24gbWVudVxuICovXG5maWxsQnJlYWRjcnVtYiA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IGJyZWFkY3J1bWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnJlYWRjcnVtYicpO1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGxpLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgYnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XG59XG5cbi8qKlxuICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cbiAqL1xuZ2V0UGFyYW1ldGVyQnlOYW1lID0gKG5hbWUsIHVybCkgPT4ge1xuICBpZiAoIXVybClcbiAgICB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgbmFtZSA9IG5hbWUucmVwbGFjZSgvW1xcW1xcXV0vZywgJ1xcXFwkJicpO1xuICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcbiAgICByZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpO1xuICBpZiAoIXJlc3VsdHMpXG4gICAgcmV0dXJuIG51bGw7XG4gIGlmICghcmVzdWx0c1syXSlcbiAgICByZXR1cm4gJyc7XG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XG59XG5cbmNsZWFyRXJyb3JNZXNzYWdlID0gKGV2ZW50LCBpZCkgPT4ge1xuICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2lkfS1lcnJvcmApLmlubmVySFRNTCA9IFwiXCI7XG59XG5cbm5ld1Jldmlld2Zvcm1SZXNldCA9ICgpID0+IHtcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25ldy1yZXZpZXctZm9ybScpLnJlc2V0KCk7XG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmV2aWV3ZXItbmFtZS1lcnJvclwiKS5pbm5lckhUTUwgPSBcIlwiO1xuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJldmlld2VyLWNvbW1lbnRzLWVycm9yXCIpLmlubmVySFRNTCA9IFwiXCI7XG59XG5cbmFkZFJldmlld0hUTUxUb0RPTSA9IChyZXZpZXdPYmopID0+IHtcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XG4gIHVsLmluc2VydEJlZm9yZShjcmVhdGVSZXZpZXdIVE1MKHJldmlld09iaiksIHVsLmNoaWxkTm9kZXNbMF0pO1xufVxuXG5hZGROZXdSZXZpZXcgPSAoZXZlbnQpID0+IHtcbiAgLy9ldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCByZXZpZXdBdXRob3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJldmlld2VyLW5hbWVcIikudmFsdWU7XG4gIC8vY29uc3QgcmV2aWV3ZXJSYXRpbmdTZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJldmlld2VyLXJhdGluZy1zZWxlY3RcIik7XG4gIC8vY29uc3QgcmV2aWV3ZXJSYXRpbmcgPSByZXZpZXdlclJhdGluZ1NlbGVjdC5vcHRpb25zW3Jldmlld2VyUmF0aW5nU2VsZWN0LnNlbGVjdGVkSW5kZXhdLnZhbHVlO1xuICBjb25zdCByZXZpZXdlclJhdGluZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcmV2aWV3ZXItcmF0aW5nLXNlbGVjdCBvcHRpb246Y2hlY2tlZFwiKS52YWx1ZTtcbiAgY29uc3QgcmV2aWV3ZXJDb21tZW50cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmV2aWV3ZXItY29tbWVudHNcIikudmFsdWU7XG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmV2aWV3ZXItbmFtZS1lcnJvclwiKS5pbm5lckhUTUwgPSBcIlwiO1xuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJldmlld2VyLWNvbW1lbnRzLWVycm9yXCIpLmlubmVySFRNTCA9IFwiXCI7XG5cbiAgaWYgKHJldmlld0F1dGhvciA9PSBcIlwiKSB7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXZpZXdlci1uYW1lLWVycm9yXCIpLmlubmVySFRNTCA9IFwiUGxlYXNlIGVudGVyIHlvdXIgbmFtZVwiO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGlmIChyZXZpZXdlckNvbW1lbnRzID09IFwiXCIpIHtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJldmlld2VyLWNvbW1lbnRzLWVycm9yXCIpLmlubmVySFRNTCA9IFwiUGxlYXNlIGVudGVyIHlvdXIgY29tbWVudHNcIjtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFkZC1yZXZpZXctc3VibWl0XCIpLmRpc2FibGVkID0gdHJ1ZTtcbiAgY29uc29sZS5sb2coc2VsZi5yZXN0YXVyYW50LmlkLCByZXZpZXdBdXRob3IsIHJldmlld2VyUmF0aW5nLCByZXZpZXdlckNvbW1lbnRzKTtcbiAgY29uc3QgcmV2aWV3T2JqID0ge1xuICAgIFwicmVzdGF1cmFudF9pZFwiOiBwYXJzZUludChzZWxmLnJlc3RhdXJhbnQuaWQpLFxuICAgIFwibmFtZVwiOiByZXZpZXdBdXRob3IsXG4gICAgXCJyYXRpbmdcIjogcGFyc2VJbnQocmV2aWV3ZXJSYXRpbmcpLFxuICAgIFwiY29tbWVudHNcIjogcmV2aWV3ZXJDb21tZW50c1xuICB9O1xuXG4gIGNvbnN0IElEQm9iaiA9IHtcbiAgICBcInJlc3RhdXJhbnRfaWRcIjogcGFyc2VJbnQoc2VsZi5yZXN0YXVyYW50LmlkKSxcbiAgICBcIm5hbWVcIjogcmV2aWV3QXV0aG9yLFxuICAgIFwicmF0aW5nXCI6IHBhcnNlSW50KHJldmlld2VyUmF0aW5nKSxcbiAgICBcImNvbW1lbnRzXCI6IHJldmlld2VyQ29tbWVudHMsXG4gICAgXCJjcmVhdGVkQXRcIjogbmV3IERhdGUoKVxuICB9XG5cbiAgLy8gY29uc29sZS5sb2coJ3JvYmouLicsIHJvYmopO1xuICBEQkhlbHBlci5hZGROZXdSZXZpZXcoc2VsZi5yZXN0YXVyYW50LmlkLCByZXZpZXdPYmosIChlcnJvciwgcmV2aWV3KSA9PiB7XG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIlVuYWJsZSB0byBhZGQgbmV3IHJldmlldyB0byBzZXJ2ZXJcIiwgZXJyb3IpO1xuICAgIH1cbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFkZC1yZXZpZXctc3VibWl0XCIpLmRpc2FibGVkID0gZmFsc2U7XG4gIH0pO1xuICAvL0RCSGVscGVyLmFkZE5ld1JldmlldyhzZWxmLnJlc3RhdXJhbnQuaWQsIHJldmlld09iaik7XG4gIGFkZFJldmlld0hUTUxUb0RPTShJREJvYmopO1xuICBuZXdSZXZpZXdmb3JtUmVzZXQoKTtcblxufSJdLCJmaWxlIjoicmVzdGF1cmFudF9pbmZvLmpzIn0=
