'use strict';

let restaurantNeighborhoods;
let restaurantCuisines;
let restaurantsList; //const port = 1337 // Change this to your server port

/**
 * Common database helper functions.
 */

class DBHelper {
  /**
    * Database URL.
    * Change this to restaurants.json file location on your server.
    */
  static get DATABASE_URL() {
    return `http://localhost:${port}/restaurants`;
  }
  /**
   * Database Review URL. 
   */


  static get DATABASE_REVIEW_URL() {
    return `http://localhost:${port}/reviews`;
  }
  /**
   * Map location latitude and longitude
   */


  static get MAP_LOC() {
    return {
      lat: 40.722216,
      lng: -73.987501
    };
  }
  /**
  * Fetch all restaurants.
  */


  static fetchRestaurants(callback, id) {
    return IDBHelper.fetchFromIDB().then(restaurants => {
      if (restaurants.length > 0) {
        return Promise.resolve(restaurants);
      } else {
        return IDBHelper.fetchFromAPIInsertIntoIDB(id);
      }
    }).then(restaurants => {
      restaurantsList = restaurants;
      const neighborhoods = restaurants.map((v, i) => restaurants[i].neighborhood);
      restaurantNeighborhoods = neighborhoods.filter((v, i) => neighborhoods.indexOf(v) == i);
      const cuisines = restaurants.map((v, i) => restaurants[i].cuisine_type);
      restaurantCuisines = cuisines.filter((v, i) => cuisines.indexOf(v) == i);
      callback(null, restaurants);
    }).catch(error => {
      callback(error, null);
    });
  }
  /**
   * Fetch a restaurant by its ID.
   */


  static fetchRestaurantById(id, callback) {
    if (restaurantsList !== undefined && restaurantsList && restaurantsList.length > 0) {
      const restaurant = restaurantsList.find(r => r.id == id);

      if (restaurant) {
        // Got the restaurant
        callback(null, restaurant);
      } else {
        callback('Restaurant does not exist', null);
      }

      return;
    } // fetch all restaurants with proper error handling.


    DBHelper.fetchRestaurants((error, restaurants) => {
      if (error) {
        callback(error, null);
      } else {
        const restaurant = restaurants.find(r => r.id == id);

        if (restaurant) {
          // Got the restaurant
          callback(null, restaurant);
        } else {
          // Restaurant does not exist in the database
          callback('Restaurant does not exist', null);
        }
      }
    });
  }
  /**
   * Fetch restaurants by a cuisine type with proper error handling.
   */


  static fetchRestaurantByCuisine(cuisine, callback) {
    if (restaurantsList !== undefined && restaurantsList && restaurantsList.length > 0) {
      const results = restaurantsList.filter(r => r.cuisine_type == cuisine);
      callback(null, results);
      return;
    } // Fetch all restaurants  with proper error handling


    DBHelper.fetchRestaurants((error, restaurants) => {
      if (error) {
        callback(error, null);
      } else {
        // Filter restaurants to have only given cuisine type
        const results = restaurants.filter(r => r.cuisine_type == cuisine);
        callback(null, results);
      }
    });
  }
  /**
   * Fetch restaurants by a neighborhood with proper error handling.
   */


  static fetchRestaurantByNeighborhood(neighborhood, callback) {
    if (restaurantsList !== undefined && restaurantsList && restaurantsList.length > 0) {
      const results = restaurantsList.filter(r => r.neighborhood == neighborhood);
      callback(null, results);
      return;
    } // Fetch all restaurants


    DBHelper.fetchRestaurants((error, restaurants) => {
      if (error) {
        callback(error, null);
      } else {
        // Filter restaurants to have only given neighborhood
        const results = restaurants.filter(r => r.neighborhood == neighborhood);
        callback(null, results);
      }
    });
  }
  /**
   * Fetch restaurants by a cuisine and a neighborhood with proper error handling.
   */


  static fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood, callback) {
    if (restaurantsList !== undefined && restaurantsList && restaurantsList.length > 0) {
      let results = restaurantsList;

      if (cuisine != 'all') {
        // filter by cuisine
        results = results.filter(r => r.cuisine_type == cuisine);
      }

      if (neighborhood != 'all') {
        // filter by neighborhood
        results = results.filter(r => r.neighborhood == neighborhood);
      }

      callback(null, results);
      return;
    } // Fetch all restaurants


    DBHelper.fetchRestaurants((error, restaurants) => {
      if (error) {
        callback(error, null);
      } else {
        let results = restaurants;

        if (cuisine != 'all') {
          // filter by cuisine
          results = results.filter(r => r.cuisine_type == cuisine);
        }

        if (neighborhood != 'all') {
          // filter by neighborhood
          results = results.filter(r => r.neighborhood == neighborhood);
        }

        callback(null, results);
      }
    });
  }
  /**
   * Fetch all neighborhoods with proper error handling.
   */


  static fetchNeighborhoods(callback) {
    if (restaurantNeighborhoods !== undefined && restaurantNeighborhoods && restaurantNeighborhoods.length > 0) {
      callback(null, restaurantNeighborhoods);
      return;
    } // Fetch all restaurants


    DBHelper.fetchRestaurants((error, restaurants) => {
      if (error) {
        callback(error, null);
      } else {
        // Get all neighborhoods from all restaurants
        const neighborhoods = restaurants.map((v, i) => restaurants[i].neighborhood); // Remove duplicates from neighborhoods

        const uniqueNeighborhoods = neighborhoods.filter((v, i) => neighborhoods.indexOf(v) == i);
        callback(null, uniqueNeighborhoods);
      }
    });
  }
  /**
   * Fetch all cuisines with proper error handling.
   */


  static fetchCuisines(callback) {
    if (restaurantCuisines !== undefined && restaurantCuisines && restaurantCuisines.length > 0) {
      callback(null, restaurantCuisines);
      return;
    } // Fetch all restaurants


    DBHelper.fetchRestaurants((error, restaurants) => {
      if (error) {
        callback(error, null);
      } else {
        // Get all cuisines from all restaurants
        const cuisines = restaurants.map((v, i) => restaurants[i].cuisine_type); // Remove duplicates from cuisines

        const uniqueCuisines = cuisines.filter((v, i) => cuisines.indexOf(v) == i);
        callback(null, uniqueCuisines);
      }
    });
  }
  /**
   * Restaurant page URL.
   */


  static urlForRestaurant(restaurant) {
    return `./restaurant.html?id=${restaurant.id}`;
  }
  /**
   * Restaurant image URL.
   */


  static imageUrlForRestaurant(restaurant, type) {
    return `/img/${type}/${restaurant.id}.jpg`;
  }
  /**
   * Map marker for a restaurant.
   */


  static mapMarkerForRestaurant(restaurant, map) {
    const marker = new google.maps.Marker({
      position: restaurant.latlng,
      title: restaurant.name,
      url: DBHelper.urlForRestaurant(restaurant),
      map: map,
      animation: google.maps.Animation.DROP
    });
    return marker;
  }
  /**
  * Change restaurant favorite state.
  */


  static updateIsFavorite(restaurantId, newState) {
    IDBHelper.updateIsFavorite(restaurantId, newState);
  }
  /**
   * Fetch all reviews.
   */


  static fetchReviewsByRestaurantId(restaurantId, callback) {
    return IDBHelper.fetchReviewsFromIDBByRestaurantId(restaurantId).then(reviews => {
      if (reviews && reviews.length > 0) {
        return Promise.resolve(reviews);
      } else {
        return IDBHelper.fetchReviewsFromAPIInsertIntoIDB(restaurantId);
      }
    }).then(reviews => {
      callback(null, reviews.reverse());
    }).catch(error => {
      callback(error, null);
    });
  }

  static updateReviewWhenOnline(obj, callback) {
    localStorage.setItem('offline-review-data', JSON.stringify(obj.data));
    window.addEventListener('online', event => {
      console.log("connection is online now");
      const offlineData = JSON.parse(localStorage.getItem('offline-review-data'));
      const offlineReviews = document.querySelectorAll('.review-offline-mode');
      document.querySelector('.offline-mode-label').remove();
      [...offlineReviews].forEach(review => {
        review.classList.remove('review-offline-mode');
      });

      if (offlineData != null) {
        if (obj.type === 'review') {
          this.addNewReview(offlineData["restaurant_id"], offlineData, callback);
        }

        localStorage.removeItem('offline-review-data');
      }
    });
  }

  static addNewReview(restaurantId, reviewObj, callback) {
    const obj = {
      data: reviewObj,
      type: 'review'
    };

    if (!window.navigator.onLine && obj.type === 'review') {
      this.updateReviewWhenOnline(obj, callback);
      return;
    }

    IDBHelper.addNewReview(restaurantId, reviewObj, (error, result) => {
      if (error) {
        callback(error, null);
        return;
      }

      callback(null, result);
    });
  }
  /**   
   * Display Restaurant Map Marker on Static Map
   */


  static displayStaticMap(restaurants) {
    let url = `https://maps.googleapis.com/maps/api/staticmap?center=${this.MAP_LOC.lat},${this.MAP_LOC.lng}&zoom=12&size=${document.documentElement.clientWidth}x400&markers=color:red`;
    restaurants.forEach(r => {
      url += `|${r.latlng.lat},${r.latlng.lng}`;
    });
    url += "&key=AIzaSyBQIcEDJHQfAjAU9DA7PaMHTh8T3BnETkk";
    return url;
  }

  static displayStaticMapOnDetailsPage(restaurant) {
    let url = `https://maps.googleapis.com/maps/api/staticmap?center=${restaurant.latlng.lat},${restaurant.latlng.lng}&zoom=16&size=${document.documentElement.clientWidth}x400&markers=color:red`;
    url += `|${restaurant.latlng.lat},${restaurant.latlng.lng}|`;
    url += "&key=AIzaSyBQIcEDJHQfAjAU9DA7PaMHTh8T3BnETkk";
    return url;
  }

}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIl0sIm5hbWVzIjpbInJlc3RhdXJhbnROZWlnaGJvcmhvb2RzIiwicmVzdGF1cmFudEN1aXNpbmVzIiwicmVzdGF1cmFudHNMaXN0IiwiREJIZWxwZXIiLCJEQVRBQkFTRV9VUkwiLCJwb3J0IiwiREFUQUJBU0VfUkVWSUVXX1VSTCIsIk1BUF9MT0MiLCJsYXQiLCJsbmciLCJmZXRjaFJlc3RhdXJhbnRzIiwiY2FsbGJhY2siLCJpZCIsIklEQkhlbHBlciIsImZldGNoRnJvbUlEQiIsInRoZW4iLCJyZXN0YXVyYW50cyIsImxlbmd0aCIsIlByb21pc2UiLCJyZXNvbHZlIiwiZmV0Y2hGcm9tQVBJSW5zZXJ0SW50b0lEQiIsIm5laWdoYm9yaG9vZHMiLCJtYXAiLCJ2IiwiaSIsIm5laWdoYm9yaG9vZCIsImZpbHRlciIsImluZGV4T2YiLCJjdWlzaW5lcyIsImN1aXNpbmVfdHlwZSIsImNhdGNoIiwiZXJyb3IiLCJmZXRjaFJlc3RhdXJhbnRCeUlkIiwidW5kZWZpbmVkIiwicmVzdGF1cmFudCIsImZpbmQiLCJyIiwiZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lIiwiY3Vpc2luZSIsInJlc3VsdHMiLCJmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZCIsImZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZCIsImZldGNoTmVpZ2hib3Job29kcyIsInVuaXF1ZU5laWdoYm9yaG9vZHMiLCJmZXRjaEN1aXNpbmVzIiwidW5pcXVlQ3Vpc2luZXMiLCJ1cmxGb3JSZXN0YXVyYW50IiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwidHlwZSIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJtYXJrZXIiLCJnb29nbGUiLCJtYXBzIiwiTWFya2VyIiwicG9zaXRpb24iLCJsYXRsbmciLCJ0aXRsZSIsIm5hbWUiLCJ1cmwiLCJhbmltYXRpb24iLCJBbmltYXRpb24iLCJEUk9QIiwidXBkYXRlSXNGYXZvcml0ZSIsInJlc3RhdXJhbnRJZCIsIm5ld1N0YXRlIiwiZmV0Y2hSZXZpZXdzQnlSZXN0YXVyYW50SWQiLCJmZXRjaFJldmlld3NGcm9tSURCQnlSZXN0YXVyYW50SWQiLCJyZXZpZXdzIiwiZmV0Y2hSZXZpZXdzRnJvbUFQSUluc2VydEludG9JREIiLCJyZXZlcnNlIiwidXBkYXRlUmV2aWV3V2hlbk9ubGluZSIsIm9iaiIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJKU09OIiwic3RyaW5naWZ5IiwiZGF0YSIsIndpbmRvdyIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsImNvbnNvbGUiLCJsb2ciLCJvZmZsaW5lRGF0YSIsInBhcnNlIiwiZ2V0SXRlbSIsIm9mZmxpbmVSZXZpZXdzIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwicXVlcnlTZWxlY3RvciIsInJlbW92ZSIsImZvckVhY2giLCJyZXZpZXciLCJjbGFzc0xpc3QiLCJhZGROZXdSZXZpZXciLCJyZW1vdmVJdGVtIiwicmV2aWV3T2JqIiwibmF2aWdhdG9yIiwib25MaW5lIiwicmVzdWx0IiwiZGlzcGxheVN0YXRpY01hcCIsImRvY3VtZW50RWxlbWVudCIsImNsaWVudFdpZHRoIiwiZGlzcGxheVN0YXRpY01hcE9uRGV0YWlsc1BhZ2UiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLElBQUlBLHVCQUFKO0FBQ0EsSUFBSUMsa0JBQUo7QUFDQSxJQUFJQyxlQUFKLEMsQ0FDQTs7QUFFQTs7OztBQUdBLE1BQU1DLFFBQU4sQ0FBZTtBQUNiOzs7O0FBSUEsYUFBV0MsWUFBWCxHQUEwQjtBQUN4QixXQUFRLG9CQUFtQkMsSUFBSyxjQUFoQztBQUNEO0FBRUQ7Ozs7O0FBR0EsYUFBV0MsbUJBQVgsR0FBaUM7QUFDL0IsV0FBUSxvQkFBbUJELElBQUssVUFBaEM7QUFDRDtBQUVEOzs7OztBQUdBLGFBQVdFLE9BQVgsR0FBb0I7QUFDbEIsV0FBTztBQUNMQyxNQUFBQSxHQUFHLEVBQUUsU0FEQTtBQUVMQyxNQUFBQSxHQUFHLEVBQUUsQ0FBQztBQUZELEtB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QUFBLFdBQVcsQ0FBQzBFLE9BQVosQ0FBb0J0RCxDQUFDLElBQUk7QUFDdkJzQixNQUFBQSxHQUFHLElBQUssSUFBR3RCLENBQUMsQ0FBQ21CLE1BQUYsQ0FBUy9DLEdBQUksSUFBRzRCLENBQUMsQ0FBQ21CLE1BQUYsQ0FBUzlDLEdBQUksRUFBeEM7QUFDRCxLQUZEO0FBR0FpRCxJQUFBQSxHQUFHLElBQUksOENBQVA7QUFDQSxXQUFPQSxHQUFQO0FBQ0Q7O0FBRUQsU0FBTzRDLDZCQUFQLENBQXFDcEUsVUFBckMsRUFBZ0Q7QUFDOUMsUUFBSXdCLEdBQUcsR0FBSSx5REFDVHhCLFVBQVUsQ0FBQ3FCLE1BQVgsQ0FBa0IvQyxHQUFJLElBQUcwQixVQUFVLENBQUNxQixNQUFYLENBQWtCOUMsR0FBSSxpQkFDakQ2RSxRQUFRLENBQUNjLGVBQVQsQ0FBeUJDLFdBQVksd0JBRnJDO0FBR0EzQyxJQUFBQSxHQUFHLElBQUssSUFBR3hCLFVBQVUsQ0FBQ3FCLE1BQVgsQ0FBa0IvQyxHQUFJLElBQUcwQixVQUFVLENBQUNxQixNQUFYLENBQWtCOUMsR0FBSSxHQUExRDtBQUNBaUQsSUFBQUEsR0FBRyxJQUFJLDhDQUFQO0FBQ0EsV0FBT0EsR0FBUDtBQUNEOztBQTNUWSIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcclxuXHJcbmxldCByZXN0YXVyYW50TmVpZ2hib3Job29kcztcclxubGV0IHJlc3RhdXJhbnRDdWlzaW5lcztcclxubGV0IHJlc3RhdXJhbnRzTGlzdDtcclxuLy9jb25zdCBwb3J0ID0gMTMzNyAvLyBDaGFuZ2UgdGhpcyB0byB5b3VyIHNlcnZlciBwb3J0XHJcblxyXG4vKipcclxuICogQ29tbW9uIGRhdGFiYXNlIGhlbHBlciBmdW5jdGlvbnMuXHJcbiAqL1xyXG5jbGFzcyBEQkhlbHBlciB7XHJcbiAgLyoqXHJcbiAgICAqIERhdGFiYXNlIFVSTC5cclxuICAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxyXG4gICAgKi9cclxuICBzdGF0aWMgZ2V0IERBVEFCQVNFX1VSTCgpIHtcclxuICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L3Jlc3RhdXJhbnRzYDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIERhdGFiYXNlIFJldmlldyBVUkwuIFxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXQgREFUQUJBU0VfUkVWSUVXX1VSTCgpIHtcclxuICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L3Jldmlld3NgO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTWFwIGxvY2F0aW9uIGxhdGl0dWRlIGFuZCBsb25naXR1ZGVcclxuICAgKi9cclxuICBzdGF0aWMgZ2V0IE1BUF9MT0MoKXtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGxhdDogNDAuNzIyMjE2LFxyXG4gICAgICBsbmc6IC03My45ODc1MDFcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cclxuICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrLCBpZCkgeyAgICBcclxuICAgIHJldHVybiBJREJIZWxwZXIuZmV0Y2hGcm9tSURCKClcclxuICAgICAgLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICAgIGlmIChyZXN0YXVyYW50cy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHJlc3RhdXJhbnRzKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIElEQkhlbHBlci5mZXRjaEZyb21BUElJbnNlcnRJbnRvSURCKGlkKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pLnRoZW4ocmVzdGF1cmFudHMgPT4ge1xyXG4gICAgICAgIHJlc3RhdXJhbnRzTGlzdCA9IHJlc3RhdXJhbnRzOyAgICAgICAgXHJcbiAgICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kKTtcclxuICAgICAgICByZXN0YXVyYW50TmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSk7XHJcbiAgICAgICAgcmVzdGF1cmFudEN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKCh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGkpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcclxuICAgICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcclxuICAgIGlmIChyZXN0YXVyYW50c0xpc3QgIT09IHVuZGVmaW5lZCAmJiAocmVzdGF1cmFudHNMaXN0ICYmIHJlc3RhdXJhbnRzTGlzdC5sZW5ndGggPiAwKSkge1xyXG4gICAgICBjb25zdCByZXN0YXVyYW50ID0gcmVzdGF1cmFudHNMaXN0LmZpbmQociA9PiByLmlkID09IGlkKTtcclxuICAgICAgaWYgKHJlc3RhdXJhbnQpIHsgLy8gR290IHRoZSByZXN0YXVyYW50XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY2FsbGJhY2soJ1Jlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QnLCBudWxsKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICAvLyBmZXRjaCBhbGwgcmVzdGF1cmFudHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2UgeyAgICAgIFxyXG4gICAgICAgIGNvbnN0IHJlc3RhdXJhbnQgPSByZXN0YXVyYW50cy5maW5kKHIgPT4gci5pZCA9PSBpZCk7XHJcbiAgICAgICAgaWYgKHJlc3RhdXJhbnQpIHsgLy8gR290IHRoZSByZXN0YXVyYW50XHJcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcclxuICAgICAgICB9IGVsc2UgeyAvLyBSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0IGluIHRoZSBkYXRhYmFzZVxyXG4gICAgICAgICAgY2FsbGJhY2soJ1Jlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QnLCBudWxsKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykgeyAgICBcclxuICAgIGlmIChyZXN0YXVyYW50c0xpc3QgIT09IHVuZGVmaW5lZCAmJiAocmVzdGF1cmFudHNMaXN0ICYmIHJlc3RhdXJhbnRzTGlzdC5sZW5ndGggPiAwKSkge1xyXG4gICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHNMaXN0LmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGN1aXNpbmUgdHlwZVxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xyXG4gICAgaWYgKHJlc3RhdXJhbnRzTGlzdCAhPT0gdW5kZWZpbmVkICYmIChyZXN0YXVyYW50c0xpc3QgJiYgcmVzdGF1cmFudHNMaXN0Lmxlbmd0aCA+IDApKSB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50c0xpc3QuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XHJcbiAgICBpZiAocmVzdGF1cmFudHNMaXN0ICE9PSB1bmRlZmluZWQgJiYgKHJlc3RhdXJhbnRzTGlzdCAmJiByZXN0YXVyYW50c0xpc3QubGVuZ3RoID4gMCkpIHtcclxuICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50c0xpc3Q7XHJcbiAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBjdWlzaW5lXHJcbiAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXHJcbiAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgfVxyXG4gICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxldCByZXN1bHRzID0gcmVzdGF1cmFudHNcclxuICAgICAgICBpZiAoY3Vpc2luZSAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xyXG4gICAgaWYgKHJlc3RhdXJhbnROZWlnaGJvcmhvb2RzICE9PSB1bmRlZmluZWQgJiYgKHJlc3RhdXJhbnROZWlnaGJvcmhvb2RzICYmIHJlc3RhdXJhbnROZWlnaGJvcmhvb2RzLmxlbmd0aCA+IDApKSB7ICAgIFxyXG4gICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50TmVpZ2hib3Job29kcyk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2QpXHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSlcclxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVOZWlnaGJvcmhvb2RzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoQ3Vpc2luZXMoY2FsbGJhY2spIHtcclxuICAgIGlmIChyZXN0YXVyYW50Q3Vpc2luZXMgIT09IHVuZGVmaW5lZCAmJiAocmVzdGF1cmFudEN1aXNpbmVzICYmIHJlc3RhdXJhbnRDdWlzaW5lcy5sZW5ndGggPiAwKSkgeyAgICAgICAgXHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRDdWlzaW5lcyk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpXHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKCh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGkpXHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCB0eXBlKSB7XHJcbiAgICByZXR1cm4gKGAvaW1nLyR7dHlwZX0vJHtyZXN0YXVyYW50LmlkfS5qcGdgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cclxuICAgKi9cclxuICBzdGF0aWMgbWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcclxuICAgIGNvbnN0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICBwb3NpdGlvbjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgIHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXHJcbiAgICAgIHVybDogREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSxcclxuICAgICAgbWFwOiBtYXAsXHJcbiAgICAgIGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1BcclxuICAgIH1cclxuICAgICk7XHJcbiAgICByZXR1cm4gbWFya2VyO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgKiBDaGFuZ2UgcmVzdGF1cmFudCBmYXZvcml0ZSBzdGF0ZS5cclxuICAqL1xyXG4gIHN0YXRpYyB1cGRhdGVJc0Zhdm9yaXRlKHJlc3RhdXJhbnRJZCwgbmV3U3RhdGUpIHtcclxuICAgIElEQkhlbHBlci51cGRhdGVJc0Zhdm9yaXRlKHJlc3RhdXJhbnRJZCwgbmV3U3RhdGUpO1xyXG4gIH1cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXZpZXdzLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJldmlld3NCeVJlc3RhdXJhbnRJZChyZXN0YXVyYW50SWQsIGNhbGxiYWNrKSB7XHJcbiAgICByZXR1cm4gSURCSGVscGVyLmZldGNoUmV2aWV3c0Zyb21JREJCeVJlc3RhdXJhbnRJZChyZXN0YXVyYW50SWQpLnRoZW4ocmV2aWV3cyA9PiB7XHJcbiAgICAgIGlmIChyZXZpZXdzICYmIHJldmlld3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmV2aWV3cyk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIElEQkhlbHBlci5mZXRjaFJldmlld3NGcm9tQVBJSW5zZXJ0SW50b0lEQihyZXN0YXVyYW50SWQpO1xyXG4gICAgICB9XHJcbiAgICB9KS50aGVuKHJldmlld3MgPT4ge1xyXG4gICAgICBjYWxsYmFjayhudWxsLCByZXZpZXdzLnJldmVyc2UoKSk7XHJcbiAgICB9KS5jYXRjaChlcnJvciA9PiB7XHJcbiAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHVwZGF0ZVJldmlld1doZW5PbmxpbmUob2JqLCBjYWxsYmFjaykge1xyXG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ29mZmxpbmUtcmV2aWV3LWRhdGEnLCBKU09OLnN0cmluZ2lmeShvYmouZGF0YSkpO1xyXG5cclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvbmxpbmUnLCBldmVudCA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKFwiY29ubmVjdGlvbiBpcyBvbmxpbmUgbm93XCIpO1xyXG4gICAgICBjb25zdCBvZmZsaW5lRGF0YSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ29mZmxpbmUtcmV2aWV3LWRhdGEnKSk7XHJcbiAgICAgIGNvbnN0IG9mZmxpbmVSZXZpZXdzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnJldmlldy1vZmZsaW5lLW1vZGUnKTtcclxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm9mZmxpbmUtbW9kZS1sYWJlbCcpLnJlbW92ZSgpO1xyXG4gICAgICBbLi4ub2ZmbGluZVJldmlld3NdLmZvckVhY2gocmV2aWV3ID0+IHtcclxuICAgICAgICByZXZpZXcuY2xhc3NMaXN0LnJlbW92ZSgncmV2aWV3LW9mZmxpbmUtbW9kZScpO1xyXG4gICAgICB9KVxyXG4gICAgIFxyXG4gICAgICBpZiAob2ZmbGluZURhdGEgIT0gbnVsbCkge1xyXG4gICAgICAgIGlmIChvYmoudHlwZSA9PT0gJ3JldmlldycpIHsgICAgICAgICBcclxuICAgICAgICAgIHRoaXMuYWRkTmV3UmV2aWV3KG9mZmxpbmVEYXRhW1wicmVzdGF1cmFudF9pZFwiXSwgb2ZmbGluZURhdGEsIGNhbGxiYWNrKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ29mZmxpbmUtcmV2aWV3LWRhdGEnKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgYWRkTmV3UmV2aWV3KHJlc3RhdXJhbnRJZCwgcmV2aWV3T2JqLCBjYWxsYmFjaykge1xyXG4gICAgY29uc3Qgb2JqID0ge1xyXG4gICAgICBkYXRhOiByZXZpZXdPYmosXHJcbiAgICAgIHR5cGU6ICdyZXZpZXcnXHJcbiAgICB9O1xyXG5cclxuICAgIGlmICghd2luZG93Lm5hdmlnYXRvci5vbkxpbmUgJiYgb2JqLnR5cGUgPT09ICdyZXZpZXcnKSB7XHJcbiAgICAgIHRoaXMudXBkYXRlUmV2aWV3V2hlbk9ubGluZShvYmosIGNhbGxiYWNrKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIElEQkhlbHBlci5hZGROZXdSZXZpZXcocmVzdGF1cmFudElkLCByZXZpZXdPYmosIChlcnJvciwgcmVzdWx0KSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0KTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqICAgXHJcbiAgICogRGlzcGxheSBSZXN0YXVyYW50IE1hcCBNYXJrZXIgb24gU3RhdGljIE1hcFxyXG4gICAqL1xyXG4gIHN0YXRpYyBkaXNwbGF5U3RhdGljTWFwKHJlc3RhdXJhbnRzKSB7XHJcbiAgICBsZXQgdXJsID0gYGh0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9zdGF0aWNtYXA/Y2VudGVyPSR7XHJcbiAgICB0aGlzLk1BUF9MT0MubGF0fSwke3RoaXMuTUFQX0xPQy5sbmd9Jnpvb209MTImc2l6ZT0ke1xyXG4gICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRofXg0MDAmbWFya2Vycz1jb2xvcjpyZWRgO1xyXG4gICAgcmVzdGF1cmFudHMuZm9yRWFjaChyID0+IHtcclxuICAgICAgdXJsICs9IGB8JHtyLmxhdGxuZy5sYXR9LCR7ci5sYXRsbmcubG5nfWA7XHJcbiAgICB9KTtcclxuICAgIHVybCArPSBcIiZrZXk9QUl6YVN5QlFJY0VESkhRZkFqQVU5REE3UGFNSFRoOFQzQm5FVGtrXCI7XHJcbiAgICByZXR1cm4gdXJsO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGRpc3BsYXlTdGF0aWNNYXBPbkRldGFpbHNQYWdlKHJlc3RhdXJhbnQpe1xyXG4gICAgbGV0IHVybCA9IGBodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvc3RhdGljbWFwP2NlbnRlcj0ke1xyXG4gICAgICByZXN0YXVyYW50LmxhdGxuZy5sYXR9LCR7cmVzdGF1cmFudC5sYXRsbmcubG5nfSZ6b29tPTE2JnNpemU9JHtcclxuICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aH14NDAwJm1hcmtlcnM9Y29sb3I6cmVkYDtcclxuICAgIHVybCArPSBgfCR7cmVzdGF1cmFudC5sYXRsbmcubGF0fSwke3Jlc3RhdXJhbnQubGF0bG5nLmxuZ318YDtcclxuICAgIHVybCArPSBcIiZrZXk9QUl6YVN5QlFJY0VESkhRZkFqQVU5REE3UGFNSFRoOFQzQm5FVGtrXCI7XHJcbiAgICByZXR1cm4gdXJsO1xyXG4gIH1cclxufVxyXG4iXSwiZmlsZSI6ImRiaGVscGVyLmpzIn0=
